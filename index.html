<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>清邁 & 曼谷 海洋版1</title>

<script>
const hero = document.getElementById("hero");
const container = document.getElementById("gameContainer");
const chiangMaiMap = document.getElementById("chiangMaiMap");
const miniBangkok = document.getElementById("miniBangkok");
const nightmarket = document.getElementById("nightmarket");
const isMobile = window.innerWidth < 800;

let heroPos = {x:100, y:200};
let step = 6;
let inFlight = false;
let inBangkok = false;

function updateHero() {
  hero.style.left = heroPos.x + "px";
  hero.style.top = heroPos.y + "px";
}
updateHero();

// 鍵盤控制
const keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

// 手機控制
if (isMobile) {
  document.querySelectorAll(".btn").forEach(btn => {
    btn.addEventListener("touchstart", e => {
      e.preventDefault();
      if (btn.id === "btnEnter") keys["Enter"] = true;
      else keys[btn.id.replace("btn", "").toLowerCase()] = true;
    });
    btn.addEventListener("touchend", e => {
      e.preventDefault();
      if (btn.id === "btnEnter") keys["Enter"] = false;
      else keys[btn.id.replace("btn", "").toLowerCase()] = false;
    });
  });
}

// 碰撞判斷
function overlap(pos, el) {
  const rect = el.getBoundingClientRect();
  return !(
    pos.x + 60 < rect.left ||
    pos.x > rect.right ||
    pos.y + 60 < rect.top ||
    pos.y > rect.bottom
  );
}

// 檢查是否離開清邁地圖（全部在海上）
function leftChiangMaiMap(pos) {
  const mapRect = chiangMaiMap.getBoundingClientRect();
  // hero 的四邊
  const heroLeft = pos.x;
  const heroRight = pos.x + 60;
  const heroTop = pos.y;
  const heroBottom = pos.y + 60;

  // 若 hero 完全超出地圖範圍
  return (
    heroRight < mapRect.left ||
    heroLeft > mapRect.right ||
    heroBottom < mapRect.top ||
    heroTop > mapRect.bottom
  );
}

// 遊戲迴圈
function gameLoop() {
  if (inFlight) {
    // 飛機移動動畫
    heroPos.x += 3;
    heroPos.y += 2;
    updateHero();

    // 碰到曼谷小地圖 → 進入曼谷
    if (overlap(heroPos, miniBangkok)) {
      inFlight = false;
      inBangkok = true;
      window.location.href = "bangkok.html"; // ✅ 切換頁面
    }
  } else {
    // 一般移動
    let dx = 0, dy = 0;
    if (keys["ArrowUp"] || keys["up"]) dy -= step;
    if (keys["ArrowDown"] || keys["down"]) dy += step;
    if (keys["ArrowLeft"] || keys["left"]) dx -= step;
    if (keys["ArrowRight"] || keys["right"]) dx += step;

    const containerRect = container.getBoundingClientRect();
    heroPos.x = Math.max(0, Math.min(containerRect.width - 60, heroPos.x + dx));
    heroPos.y = Math.max(0, Math.min(containerRect.height - 60, heroPos.y + dy));
    updateHero();

    // 夜市進入相簿
    if (!inBangkok && overlap(heroPos, nightmarket) && keys["Enter"]) {
      window.location.href = "album.html";
    }

    // 離開清邁地圖 → 變飛機
    if (!inBangkok && leftChiangMaiMap(heroPos)) {
      hero.style.backgroundImage = "url('img/plane.png')";
      inFlight = true;
    }
  }

  requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>




